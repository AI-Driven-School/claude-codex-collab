#!/bin/bash
# StressAIAgent CLI - é–‰ã˜ãŸãƒ«ãƒ¼ãƒ—ã®ãŸã‚ã®çµ±ä¸€ã‚³ãƒãƒ³ãƒ‰

set -e
cd "$(dirname "$0")"

CMD=${1:-help}
shift 2>/dev/null || true

case "$CMD" in
  run|dev)
    echo "ğŸš€ Starting development servers..."
    docker-compose up -d
    (cd backend && source venv/bin/activate 2>/dev/null && uvicorn app.main:app --reload --port 8000) &
    BACKEND_PID=$!
    (cd frontend && npm run dev) &
    FRONTEND_PID=$!
    trap "kill $BACKEND_PID $FRONTEND_PID 2>/dev/null" EXIT
    wait
    ;;

  test)
    echo "ğŸ§ª Running tests..."
    npx playwright test "$@"
    ;;

  test:ui)
    echo "ğŸ§ª Running tests with UI..."
    npx playwright test --ui
    ;;

  build)
    echo "ğŸ“¦ Building..."
    cd frontend && npm run build
    ;;

  db)
    echo "ğŸ—„ï¸ Starting database..."
    docker-compose up -d
    ;;

  db:stop)
    echo "ğŸ›‘ Stopping database..."
    docker-compose down
    ;;

  log|logs)
    docker-compose logs -f
    ;;

  clean)
    echo "ğŸ§¹ Cleaning..."
    docker-compose down -v
    rm -rf frontend/.next
    rm -rf playwright-report
    ;;

  commit)
    MSG=${1:-"Update"}
    git add -A && git commit -m "$MSG"
    ;;

  status|st)
    git status -s
    ;;

  help|*)
    cat << 'EOF'
StressAIAgent CLI

Usage: ./stress <command>

Commands:
  run, dev     Start all development servers
  test         Run Playwright tests
  test:ui      Run tests with Playwright UI
  build        Build frontend
  db           Start database
  db:stop      Stop database
  logs         Show logs
  clean        Clean all artifacts
  commit <msg> Git add all & commit
  status, st   Git status

Examples:
  ./stress run
  ./stress test
  ./stress commit "Add feature"
EOF
    ;;
esac
